SOURCE_C   = $(wildcard $(PATH_SRC)/*.c)
SOURCE_CC  = $(wildcard $(PATH_SRC)/*.cc)
SOURCE_CPP = $(wildcard $(PATH_SRC)/*.cpp)

BINOBJ_C   = $(SOURCE_C:.c=.o)
BINOBJ_CC  = $(SOURCE_CC:.cc=.o)
BINOBJ_CPP = $(SOURCE_CPP:.cpp=.o)
BINOBJ     = $(BINOBJ_C) $(BINOBJ_CC) $(BINOBJ_CPP)

BIN = $(PATH_BIN)/$(SW_PACKG)
MAN = $(PATH_MAN)/$(SW_TITLE).1

COFLAGS  = $(DEP_DEFS) -D'$(SW_SYMID)_VERSION="$(SW_VERSION)"' $(FLAGS_OPT) $(FLAGS_DBG) -fopenmp -Wall -Wno-unknown-pragmas
CCFLAGS  = -std=c89 -Wno-strict-aliasing -I$(spath) $(COFLAGS)
CXXFLAGS = -ansi -pedantic -Wno-strict-aliasing $(COFLAGS)
LDFLAGS  = $(DEP_LIBS)

# Targets
$(BIN): $(BINOBJ)
	$(CXX) $(CXXFLAGS) $(BINOBJ) -o $@ $(LDFLAGS)

%.o: %.c
	$(CC) -c $(CCFLAGS) -o $@ $<

%.o: %.cc
	$(CXX) -c $(CXXFLAGS) -o $@ $<

%.o: %.cpp
	$(CXX) -c $(CXXFLAGS) -o $@ $<

.PHONY: all
all: $(BIN)

.PHONY: bin
bin: $(BIN)

.PHONY: man-preview
man-preview:
	$(CLEAR) && $(NROFF) -Tascii -man "man/xtracer.1" | $(COL) -x | $(LESS) -c

.PHONY: install
install: all
	$(INSTALL) -D -m 775 $(BIN) $(PATH_PREFIX)/bin/$(SW_PACKG)
	$(INSTALL) -D -c -m 444 $(MAN) $(PATH_PREFIX)/share/man/man1/$(SW_PACKG).1
		  
.PHONY: uninstall
uninstall:
	$(RM) -f $(PATH_PREFIX)/bin/$(SW_PACKG)
	$(RM) -f $(PATH_PREFIX)/share/man/man1/$(SW_PACKG).1

.PHONY: clean
clean:
	$(RM) -rf $(BINOBJ)

.PHONY: clean-all
clean-all: clean
	$(RM) -f Makefile
	$(RM) $(BIN)
	$(RM) -rf $(PATH_BIN)
