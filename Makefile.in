# paths
# - target
spath = src
opath = $(bpath)/obj
tpath = doc

# - sources
ccsrc = $(wildcard $(spath)/*.c)
ccsrcc = $(wildcard $(spath)/*.cc)
ccsrcpp = $(wildcard $(spath)/*.cpp)
doctex = $(wildcard $(tpath)/*.tex)

# binarys
objc = $(ccsrc:.c=.o)
objcc = $(ccsrcc:.cc=.o)
objcpp = $(ccsrcpp:.cpp=.o)

bin = $(bpath)/$(pkgname)
doc = $(bpath)/$(pkgname).pdf

PDFVIEWER = xpdf 
TEX = xelatex
RM = rm
CC = gcc
CXX = g++
COFLAGS= $(opt) $(dbg) -D'XT_VERSION="$(shell cat VERSION)"' -I/usr/local/include -Wall
CCFLAGS = -std=c89 -Wno-strict-aliasing -I$(spath) $(COFLAGS)
CXXFLAGS = -ansi -pedantic -Wno-strict-aliasing -I$(spath) $(COFLAGS)
LDFLAGS = -lpthread -lnparse -lnmath `sdl-config --libs`

$(bin): $(objc) $(objcc) $(objcpp)
	$(CXX) $(CXXFLAGS) $(objc) $(objcc) $(objcpp) -o $@ $(LDFLAGS)

$(doc): $(doctex)
	$(TEX) $(doctex)
	
%.o: %.c
	$(CC) -c $(CCFLAGS) -o $@ $<

%.o: %.cc
	$(CXX) -c $(CXXFLAGS) -o $@ $<

%.o: %.cpp
	$(CXX) -c $(CXXFLAGS) -o $@ $<

.PHONY: all
all: $(bin) $(doc)

.PHONY: doc
doc: $(doc)

.PHONY: bin 
bin: $(bin)

.PHONY: test
test: $(bin)
	clear

	./bin/xtracer ./scenes/inc* -res 320x180 -v
#	./bin/xtracer ./scenes/inc* -res 640x360 -v
#	./bin/xtracer ./scenes/inc* -res 1280x720 -v

.PHONY: clean
clean:
	$(RM) -rf $(objc) $(objcc) $(objcpp)
	$(RM) -rf $(basename $(doc)).{aux,log,out,toc}

.PHONY: clean-all
clean-all: clean
	rm -f Makefile $(bin)
